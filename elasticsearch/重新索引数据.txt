
为了有效的重新索引所有在旧的索引中的文档，用 scroll 从旧的索引检索批量文档 ， 然后用 bulk API 把文档推送到新的索引中。

可以采用 Elasticsearch 提供的 scroll 方式来实现遍历。
可以把 scroll 分为初始化和遍历两步，初始化时将所有符合搜索条件的搜索结果缓存起来，可以想象成快照，在遍历时，从这个快照里取数据，也就是说，在初始化后对索引插入、删除、更新数据都不会影响遍历结果。
初始化
POST ip:port/my_index/my_type/_search?scroll=1m
{
	"query": { "match_all": {}}
}
初始化时需要像普通 search 一样，指明 index 和 type (当然，search 是可以不指明 index 和 type 的)，然后，加上参数 scroll，表示暂存搜索结果的时间，其它就像一个普通的search请求一样。

初始化返回一个 _scroll_id，_scroll_id 用来下次取数据用。

遍历
POST /_search?scroll=1m
{
    "scroll_id":"XXXXXXXXXXXXXXXXXXXXXXX I am scroll id XXXXXXXXXXXXXXX"
}
这里的 scroll_id 即 上一次遍历取回的 _scroll_id 或者是初始化返回的 _scroll_id，同样的，需要带 scroll 参数。 重复这一步骤，直到返回的数据为空，即遍历完成。注意，每次都要传参数 scroll，刷新搜索结果的缓存时间。另外，不需要指定 index 和 type。

设置scroll的时候，需要使搜索结果缓存到下一次遍历完成，同时，也不能太长，毕竟空间有限。

Scroll-Scan（search_type=scan被移除）
Elasticsearch 提供了 Scroll-Scan 方式进一步提高遍历性能。还是上面的例子，微信大V要给粉丝群发这种后台任务，是不需要关注顺序的，只要能遍历所有数据即可，这时候，就可以用Scroll-Scan。
Scroll-Scan 的遍历与普通 Scroll 一样，初始化存在一点差别。
POST ip:port/my_index/my_type/_search?search_type=scan&scroll=1m&size=50
{
	"query": { "match_all": {}}
}
需要指明参数：
search_type。赋值为scan，表示采用 Scroll-Scan 的方式遍历，同时告诉 Elasticsearch 搜索结果不需要排序。
scroll。同上，传时间。
size。与普通的 size 不同，这个 size 表示的是每个 shard 返回的 size 数，最终结果最大为 number_of_shards * size。
Scroll-Scan 方式与普通 scroll 有几点不同：
Scroll-Scan 结果没有排序，按 index 顺序返回，没有排序，可以提高取数据性能。
初始化时只返回 _scroll_id，没有具体的 hits 结果。
size 控制的是每个分片的返回的数据量而不是整个请求返回的数据量。

scan API在2.0时代就已经不推荐使用，现在完全移除，取而代之的是scroll陪着_doc

GET /my_index/_search?scroll=2m
{
  "sort": [
    "_doc"
  ]
}
按_doc 排序是经过优化的，他和scanAPI有一样的效果

# 初始化
gswewf@gswewf-PC:~/yhb$ curl -XPOST localhost:9200/baike/baoxian/_search?scroll=1m -d '{"query": { "match_all": {}}}'
{"_scroll_id":"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAACcFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAnRZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pnAAAAAAAAAJ4WUUxSZ3drUDBUVDZhY0Q4d1h3Q2dqZwAAAAAAAACfFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAoBZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pn","took":5,"timed_out":false,"_shards":{"total":5,"successful":5,"skipped":0,"failed":0},"hits":{"total":4814,"max_score":1.0,"hits":[{"_index":"baike","_type":"baoxian","_id":"14","_score":1.0,"_source":{"answer": "平安的客户，只要注册登录平安一帐通，就可以随时查询自己的保单信息。包括聚财宝账户的信息。 也可以下载平安APP，手机随时查询。或者通过代理人，或者拨打95511，查询相关的保单信息。", "timestamp": "2017-12-26T10:57:47.733238", "question": "平安聚财宝账户怎么查", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"19","_score":1.0,"_source":{"answer": "目前各国使馆承认的境外保险销售机构包括：美亚保险、友邦保险、泰康保险、新华保险、中国人寿、民生人寿等。其中美亚、安联、大众和平安保险相对保障比较全面。因此选择申根签证保险可以在这些保险公司办理。 申根保险可以分为出境签证保险，入境签证保险，出入境签证保险，入出境签证保险，再入境签证保险和过境签证保险等六种类别。 在选择的时候，投保人要根据自己的实际情况进行选择。拥有申根保险是办理申根签证的前提，它在保额、保障期、保障内容方面申根签证保险有严格的规定。 首先要选择能符合申根规定的保险产品。然后，再在这些产品内进行比较，寻找适合自己的保险产品。申根签证保险哪个好，要求医疗保险金额不得低于3万欧元(相当于30万人民币)，且应附带全球紧急救援功能。", "timestamp": "2017-12-26T10:57:47.733251", "question": "申根签证保险哪个好", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"22","_score":1.0,"_source":{"answer": "《太平福运金生两全保险》是一款集养老、保障于一身的综合型两全产品，该产品还具有交费第三年后每年有收益、60岁后逐年递增领取、满期返还保费等特点，可匹配客户在子女教育、养老规划、家庭理财等方面的多种需求。", "timestamp": "2017-12-26T10:57:47.733259", "question": "太平福运金生b款怎么样", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"24","_score":1.0,"_source":{"answer": "1、投保年龄：0-60周岁； 2、保障期限：10-30年以下 30年-终身； 3、缴费方式：年交、月交、趸交。", "timestamp": "2017-12-26T10:57:47.733264", "question": "国寿幸福双康组合计划投保指南", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"25","_score":1.0,"_source":{"answer": "金先生，30周岁，为自己投保国寿鑫裕保险组合计划，选择10年交费、60岁开始领取养老年金(年领)，年交保费为62620元。 在金先生年满60周岁年生效对应日前，金先生于鑫裕重疾合同生效(或最后复效)之日起一百八十日内，因首次发生并经确诊的疾病导致金先生初次发生并经专科医生明确诊断患鑫裕重疾合同所指的重大疾病(无论一种或多种)，鑫裕重疾合同终止，本公司按照鑫裕重疾合同所交保险费(不计利息)给付重大疾病保险金;金先生于鑫裕重疾合同生效(或最后复效)之日起一百八十日后，因首次发生并经确诊的疾病导致金先生初次发生并经专科医生明确诊断患鑫裕重疾合同所指的重大疾病(无论一种或多种)，鑫裕重疾合同终止，本公司给付20万元重大疾病保险金。", "timestamp": "2017-12-26T10:57:47.733267", "question": "国寿鑫裕保险组合计划投保案例", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"26","_score":1.0,"_source":{"answer": "1、保险期限： 1年 2、缴费方式： 趸交 3、投保年龄： 18-65周岁", "timestamp": "2017-12-26T10:57:47.733269", "question": "太平洋花样年华保险投保指南", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"29","_score":1.0,"_source":{"answer": "1、生育保险 所谓生育保险，是指国家通过社会立法，对生育职工给予经济、物质等方面帮助的一项社会政策。主要福利在于为生育的女职员提供生育津贴、产假、医疗服务等待遇，确保女性职员在生育期间的经济收入和医疗保健。国生育保险待遇主要包括两项。一是生育津贴，二是生育医疗待遇。 女性在就职期间，单位会按照法律规定为其投保生育保险。生育保险交满12个月后即满足报销条件。在孩子出生的18个月内都可以报销，报销的同时需要再保。需要提醒的是，生育保险属于地方政策，有些地方需要在10个月或者6个月之内报销，因此以当地社保中心为准。 2、女性重大保险 女性重大疾病保险与一般重疾险、寿险最大的区别在于，将女性生育纳入到了保障范围内。女性重大疾病保险是针对女性量身定做的一款保险，在保障范围上，加入了女性特有的重大疾病保障，如乳腺癌、卵巢癌、宫颈癌等疾病的医疗保障。并且去掉了重疾险中不适用于女性的保险功能。此外保费比一般重疾险低。 女性重大疾病保险是一款适合所有孕妇的保险，在购买时还可以搭配附加女性生育健康保险。不仅能为孕妇提供保障，还能为新生儿重大疾病和特定手术提供保障。 3、母婴保险 母婴保险是一种同时保障准妈妈和宝宝的保险。在其保障的设置上，孕期疾病或意外，如弥漫性脉管凝血症、宫外孕、绒毛膜癌及恶性葡萄胎等，胎儿先天疾病，如先天性脑积水、唇裂等先天性疾病等都列入了保障范围。除了上述这些妊娠期疾病和新生儿先天性疾病外，许多母婴保险的内容还包括提供新生儿贺喜金等比较温情的保险利益。", "timestamp": "2017-12-26T10:57:47.733277", "question": "孕妇保险有哪些", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"40","_score":1.0,"_source":{"answer": "为了满足孩子一生的现金流需求，35周岁的周先生中年得女，想为0周岁的闺女敏敏投保一份理财型保险，经过比较，他选择为孩子投保国寿鑫福稳赢年金保障计划，为女儿敏敏每年投保5万元，分3年交完，小计3年保费15万元，其中，保险金额14300元，可以保障期限90周岁。 合同生效后，国寿鑫福稳赢年金的收益为： 1、特别关爱金 在敏敏5周岁时，可领取15000元作为学习上的教育金； 2、年金与祝寿金 ①敏敏5周岁至59周岁时，可每年领取4290元年金，54年的时间内共领取231660元； ②当孩子60周岁时，可领祝寿金150000元； ③如果敏敏年老时，60周岁至90周岁，这30年中，每年领429元，即429元/年*30年=12870元； 3、保费豁免 倘若小敏18周岁钱不幸身故或者高残，剩余保费豁免； 4、身故保险金 ①敏敏若60岁前身故，给付保费和现价较大值； ②她若60岁后身故，给付保单现价。", "timestamp": "2017-12-26T10:57:47.733312", "question": "国寿鑫福稳赢案例", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"41","_score":1.0,"_source":{"answer": "1、先登录淘宝，点卖家中心； 2、找到那个之前商品质量保证险的导航栏，点击进去； 3、直接按照要求取消即可。", "timestamp": "2017-12-26T10:57:47.733315", "question": "品质保证险怎么退出", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"44","_score":1.0,"_source":{"answer": "第一，意外伤害保险范围包括意外身故/残疾/烧烫伤保障。当人们遭遇意外事故之后，死亡是最坏的结果，而残疾与烧烫伤也基本上将一个人的一辈子毁了。因此，大家在投保意外伤害保险的时候，一定要注意意外身故/残疾/烧烫伤的保险金额的高低，保险金额当然是越高越好。 第二，意外伤害保险范围内还应该包括意外伤害医疗保障项目。当人们遭遇意外事故的时候，较好的结果便是需要住院，仍然有着恢复的希望。但是长期的住院需要花费非常多的钱财，因此大家在选择意外伤害保险的时候，一定要注意保险中是否提供意外伤害医疗保障。 第三，意外伤害保险范围内一定要有紧急医疗救援。当发生意外事故的时候，及时的抢救非常重要，许多人便是由于抢救不及时而死亡。如果大家投保了有紧急医疗救援保障项目的意外伤害保险，那么便能够在保险公司的帮助之下，快速的将被保险人送往医院进行抢救，以免最后由于抢救不及时而死亡。", "timestamp": "2017-12-26T10:57:47.733322", "question": "意外伤害保险范围", "description": "金巧网_保险百科_保险产品"}}]}}
gswewf@gswewf-PC:~/yhb$

# 遍历
gswewf@gswewf-PC:~/yhb$ curl -XPOST localhost:9200/_search/scroll?scroll=1m -d '{"scroll_id":"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAACcFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAnRZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pnAAAAAAAAAJ4WUUxSZ3drUDBUVDZhY0Q4d1h3Q2dqZwAAAAAAAACfFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAoBZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pn"}'
{"_scroll_id":"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAACcFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAnRZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pnAAAAAAAAAJ4WUUxSZ3drUDBUVDZhY0Q4d1h3Q2dqZwAAAAAAAACfFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAoBZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pn","took":7,"timed_out":false,"terminated_early":true,"_shards":{"total":5,"successful":5,"skipped":0,"failed":0},"hits":{"total":4814,"max_score":1.0,"hits":[{"_index":"baike","_type":"baoxian","_id":"48","_score":1.0,"_source":{"answer": "中国人寿新瑞鑫值得买吗?国寿瑞鑫两全保障计划为您提供三年一返的生存保险金及满期保险金、高达三倍保额的重疾保障、身故保障，还可享有公司分红。合同生效之日起至被保险人年满80周岁的年生效对应日止。", "timestamp": "2017-12-26T10:57:47.733332", "question": "中国人寿新瑞鑫值得买吗", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"52","_score":1.0,"_source":{"answer": "1、易安保险住院无忧是日常生活必备保障，住院医疗无论意外或疾病均可报销。 2、易安保险住院无忧有住院提供住院津贴，补偿误工费、伙食费等费用，贴心保障。 3、易安保险住院无忧是高性价比产品，同时承保人身意外和意外医疗、疾病医疗，每天0.4元，获全年安心保障。 4、易安保险住院无忧在投保过“开心保国寿‘住院宝’必备版”未出险的用户，再次投保本计划，无等待期的限制。", "timestamp": "2017-12-26T10:57:47.733343", "question": "易安保险住院无忧简介", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"60","_score":1.0,"_source":{"answer": "人保寿险无忧一生重大疾病保险有缴费低，保障高，缴费方式灵活，保障伴随终身，病种覆盖面广，随心转换养老金等特点。重疾保障扩大至54种，涵盖了目前99%的高发重疾，甚至连肆虐非洲的埃博拉病毒感染也在承保范围内，处于业内领先水平。15种轻症重疾包括原位癌、轻微脑中风等常见高发疾病。轻症责任为额外给付，如轻症赔付后再发生重疾，或身故全残，照样全额赔付。适合对象出生满28天至65岁。儿童可以保至30万元，成人可以保至80万元。", "timestamp": "2017-12-26T10:57:47.733363", "question": "人保寿险无忧一生重大疾病保险介绍", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"73","_score":1.0,"_source":{"answer": "1、养老金:若生存,从60周岁开始,每年的合同生效对应日领取26840元直至终身. 2、分享红利:每年享有红利分配权,可以现金领取也可以累积生息,有效抵御通货膨胀. 3、借款:如合同已经具有现金价值,可书面形式向本公司申请借款,方便资金周转,以解燃眉之急. 4、身故保险金:若身故,我们按身故当时合同所交保险费(不计利息)与现金价值两项金额中的较大者给付身故保险金,合同终止.", "timestamp": "2017-12-26T10:57:47.733399", "question": "国寿松鹤颐年年金保险保障范围", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"79","_score":1.0,"_source":{"answer": "开工前购买，由发包人（也就是建设单位）购买。 2013版《建设工程施工合同》（示范文本）中规定：除专用合同条款另有约定外，发包人应投保建筑工程一切险或安装工程一切险；发包人委托承包人投保的，因投保产生的保险费和其他相关费用由发包人承担。", "timestamp": "2017-12-26T10:57:47.733414", "question": "建筑工程一切险由谁购买", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"84","_score":1.0,"_source":{"answer": "1.优点。 用“五大优势”来形容平安财富鑫生年金保险一点也为过，它体现在“一生领，二返本，三滚利，四灵活，五安全”五个方面，作为理财型保险产品，它从保单第5周年开始便可以年年领取生存金，活多久领多久，活的越长，领取的越多。 其次，它返本，且身故照样返。再次，它滚利，万能账户将客户利益最大化，据悉，这些年平安年化利率维持在5%左右，保持了稳定的收益。并且它还有保单贷款功能，能够满足消费者一时资金周转不过来的需求。 2.缺点。 （1）满期返还、保费贵。 以0周岁的宝宝为例，如果聚财宝17Ⅱ，费期3年，选择65周岁返还保费，年交保费19万元。且保障20年或者至65周岁，在保障期间内，平安人寿虽然归还保费，一般返还型保险比非返还型保险保费要高一些，不还是有句俗语叫羊毛出在羊身上。 （2）万能账户滚利不确定。 虽然这些年，平安的年化利率维持在5%左右，也在世界500强中排名靠前，但是万能账户进行第二次增值，利率还真心不好说。", "timestamp": "2017-12-26T10:57:47.733427", "question": "平安财富鑫生保险的优缺点", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"89","_score":1.0,"_source":{"answer": "蔡先生，26岁，公司职员，结婚一年后宝宝即将降生。偿还房贷和养育宝宝是其未来主要的家庭负担。作为家庭经济支柱蔡先生在为家庭未来考虑时选择购买了一份泰康爱相随定期寿险。等待期一年后蔡先生因车祸不幸意外身故,保险公司在核定后,其家人获得45万元意外身故保险金。", "timestamp": "2017-12-26T10:57:47.733440", "question": "泰康爱相随定期寿险投保案例", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"92","_score":1.0,"_source":{"answer": "目前的保险理财产品主要包括三类：投连险、分红险和万能寿险。 投连险，保单现金价值可以随着投资账户里的收益不断提升。因为投资账户里的钱很大部分可以投到资本市场、股票市场，这样可以在相当程度上抵御通货膨胀。业内人士建议，投资者可以买一些给付保险金递增的产品，如果通货膨胀不断，这类产品每年的保险金也是不断增加的。 分红险，其卖点之一是定期分红，但分红险的利润来源于保险经营利润和投资带来的利差等所产生的可分配盈余，具有不确定性。据介绍，分红险设定到期基本保额，加上每年不固定的分红，可以算得上是本金安全且有保底收益、另有浮动收益的理财产品。因此，分红保险适合于风险承受能力低、有稳健理财需求、希望以保障为主的投保人群。 万能寿险，通过银行渠道销售的万能寿险保额相对固定，投保手续更加简便，通常投保人只需到银行填妥保单，并一次性缴纳保险费即可，无须核保、体检等复杂过程。 保险产品的购买要根据个人的不同条件和所处环境而定，一份好的保险规划应该不影响投保人的正常生活。业内人士说，在标准普尔家庭配资中，保险支出应该占家庭总收入的20%左右，但是，由于物价和观念不同，一般建议以年收入10%-15%的比例投资保险。", "timestamp": "2017-12-26T10:57:47.733447", "question": "理财型保险产品", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"98","_score":1.0,"_source":{"answer": "太平安逸畅行做为一款综合意外险产品，以其保障范围广，保障全面，受到了大众的广泛关注。出生满28天至60周岁皆可承保，投保者需一次交清保费，保期为1年，也就是一次性交1年的保费，到期可再续保，本产品可续保至70周岁。关键免赔额只有100元，对于投保人来说免赔额越低越有优势。", "timestamp": "2017-12-26T10:57:47.733464", "question": "太平安逸畅行怎么样", "description": "金巧网_保险百科_保险产品"}},{"_index":"baike","_type":"baoxian","_id":"99","_score":1.0,"_source":{"answer": "1、投保年龄：凡出生二十八日以上、六十周岁以下，身体健康者均可作为被保险人，由本人或对其具有保险利益的人作为投保人向中国人寿保险股份公司（以下简称本公司）投保本保险。 2、保险期限：本合同的保险期间为本合同生效之日起至被保险人身故时止。 3、保险费用：保险费的交付方式分为趸交、年交和半年交三种。分期交付保险费的，交费期间分为五年、十年、十五年和二十年四种，由投保人在投保时选择。", "timestamp": "2017-12-26T10:57:47.733467", "question": "国寿康宁终身重大疾病保险投保指南", "description": "金巧网_保险百科_保险产品"}}]}}
gswewf@gswewf-PC:~/yhb$

# 不排序进行初始化
gswewf@gswewf-PC:~/yhb$ curl -XPOST localhost:9200/baike/baoxian/_search?scroll=1m -d '{"query": { "match_all": {}}, "sort": ["_doc"]}'
{"_scroll_id":"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAACwFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAsRZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pnAAAAAAAAALIWUUxSZ3drUDBUVDZhY0Q4d1h3Q2dqZwAAAAAAAACzFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAtBZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pn","took":8,"timed_out":false,"_shards":{"total":5,"successful":5,"skipped":0,"failed":0},"hits":{"total":4814,"max_score":null,"hits":[{"_index":"baike","_type":"baoxian","_id":"14","_score":null,"_source":{"answer": "平安的客户，只要注册登录平安一帐通，就可以随时查询自己的保单信息。包括聚财宝账户的信息。 也可以下载平安APP，手机随时查询。或者通过代理人，或者拨打95511，查询相关的保单信息。", "timestamp": "2017-12-26T10:57:47.733238", "question": "平安聚财宝账户怎么查", "description": "金巧网_保险百科_保险产品"},"sort":[0]},{"_index":"baike","_type":"baoxian","_id":"5","_score":null,"_source":{"answer": "保险标的的保险价值由保险人与被保险人约定。保险人与被保险人未约定保险价值的，保险价值依照下列规定计算： 1、船舶的保险价值，是保险责任开始时船舶的价值，包括船壳、机器、设备的价值，以及船上燃料、物料、索具、给养、淡水的价值和保险费的总和； 2、货物的保险价值，是保险责任开始时货物在起运地的发票价格或者非贸易商品在起运地的实际价值以及运费和保险费的总和； 3、运费的保险价值，是保险责任开始时承运人应收运费总额和保险费的总和； 4、其他保险标的的保险价值，是保险责任开始时保险标的的实际价值和报名费的总和。", "timestamp": "2017-12-26T10:57:47.733214", "question": "船舶保险价值怎么确定", "description": "金巧网_保险百科_保险产品"},"sort":[0]},{"_index":"baike","_type":"baoxian","_id":"2","_score":null,"_source":{"answer": "意外医疗保险金：因遭受意外伤害事故在本公司认可的医疗机构进行治疗， 保险公司对其自事故发生之日起一百八十日内（含第一百八十日） 实际支出的、符合当地社会基本医疗保险规定标准及范围的医疗费用，在已经从社会基本医疗保险、公费医疗或其他途径获得补偿或赔偿的金额以及附加合同约定的免赔额后，按约定的给付比例给付意外医疗保险金。 于保险期间届满日治疗仍未结束的，保险公司继续承担保险责任， 直至意外伤害事故发生之日起第一百八十日止，但累计给付金额达到附加合同载明的对应的保险金额时，保险公司对的保险责任终止。", "timestamp": "2017-12-26T10:57:47.733204", "question": "信泰附加意外医疗保险保障范围", "description": "金巧网_保险百科_保险产品"},"sort":[0]},{"_index":"baike","_type":"baoxian","_id":"1","_score":null,"_source":{"answer": "太平洋金佑人生终身寿险怎么样？太平洋“金佑人生保障计划”在保险行业协会规定的25类重疾基础上，增加到42种，更多保障、更多安心；兼顾了医疗费用的逐年递增，特别加入重疾保额递增的功能，递增的保额免核保体检，让客户一次投保、终生无忧；在42种重疾保障之外，特别提供10种轻疾的提前给付保障，提前给付额度为重大疾病保险金的20%,及时治小病，防范于未然；除了健康保障，为客户提供终生递增的身故风险防范，身故保险金随每年主险分红水平不断递增，递增的保额免核保体检，做到生命保障与个人价值动态等值；在保障功能上，力求更全面，在提供健康、身故风险防范的同时，兼顾养老，为客户分担未来的养老之忧。", "timestamp": "2017-12-26T10:57:47.733184", "question": "太平洋金佑人生怎么样", "description": "金巧网_保险百科_保险产品"},"sort":[0]},{"_index":"baike","_type":"baoxian","_id":"3","_score":null,"_source":{"answer": "1、平安“家财宝”综合保障计划是一份保障保全家，房屋、家居财物、家人意外及医疗甚至宠物都有保障 无论是自然风险，还是意外风险或者盗抢风险都可保障的保险。 2、平安“家财宝”综合保障计划保障自然风险、意外风险、盗抢风险和家庭成员的意外伤害造成的家庭财产损失，最高的赔偿金额高达300万元，一份保险能够保障全家人的财产和生命安全。", "timestamp": "2017-12-26T10:57:47.733208", "question": "平安家财宝介绍", "description": "金巧网_保险百科_保险产品"},"sort":[0]},{"_index":"baike","_type":"baoxian","_id":"19","_score":null,"_source":{"answer": "目前各国使馆承认的境外保险销售机构包括：美亚保险、友邦保险、泰康保险、新华保险、中国人寿、民生人寿等。其中美亚、安联、大众和平安保险相对保障比较全面。因此选择申根签证保险可以在这些保险公司办理。 申根保险可以分为出境签证保险，入境签证保险，出入境签证保险，入出境签证保险，再入境签证保险和过境签证保险等六种类别。 在选择的时候，投保人要根据自己的实际情况进行选择。拥有申根保险是办理申根签证的前提，它在保额、保障期、保障内容方面申根签证保险有严格的规定。 首先要选择能符合申根规定的保险产品。然后，再在这些产品内进行比较，寻找适合自己的保险产品。申根签证保险哪个好，要求医疗保险金额不得低于3万欧元(相当于30万人民币)，且应附带全球紧急救援功能。", "timestamp": "2017-12-26T10:57:47.733251", "question": "申根签证保险哪个好", "description": "金巧网_保险百科_保险产品"},"sort":[1]},{"_index":"baike","_type":"baoxian","_id":"8","_score":null,"_source":{"answer": "1、投保年龄:16周岁-60周岁 2、保险期间:至被保险人80周岁 3、缴费方式:趸交、10年交、20年交", "timestamp": "2017-12-26T10:57:47.733223", "question": "国寿鸿寿年金保险投保指南", "description": "金巧网_保险百科_保险产品"},"sort":[1]},{"_index":"baike","_type":"baoxian","_id":"4","_score":null,"_source":{"answer": "一、投保年龄 指投保时被保险人的年龄，投保年龄以周岁计算。本主险合同接受的投保年龄为0周岁至12周岁，投保时被保险人为0周岁的，应当为出生满28日且已健康出院的婴儿。 二、保险期间 本主险合同的保险期间为自本主险合同生效时起至被保险人22周岁保单周年日零时止。 三、犹豫期 自您签收本主险合同次日起，有20日的犹豫期。在此期间请您认真审视本主险合同，如果您认为本主险合同与您的需求不相符，您可以在此期间提出解除本主险合同，我们将无息退还您所支付的全部保险费。 四、保险责任 1、大学预备金 若生存至17周岁保单周年日，保险公司在其17周岁保单周年日按主险合同基本保险金额的36%给付大学预备金。 2、大学教育金 若生存至18、19、20、21周岁保单周年日，保险公司在18、19、20、21周岁保单周年日按主险合同基本保险金额的36%给付大学教育金。 3、学业有成金 若生存至22周岁保单周年日，保险公司在22周岁保单周年 日按主险合同基本保险金额的100%给付学业有成金。 4、身故保险金 若身故，保险公司按主险合同所交保险费或身故当时主险合同的现金价值给付款身故保险金。", "timestamp": "2017-12-26T10:57:47.733211", "question": "平安金博士少儿教育年金条款", "description": "金巧网_保险百科_保险产品"},"sort":[1]},{"_index":"baike","_type":"baoxian","_id":"7","_score":null,"_source":{"answer": "作为“全佑一生”系列的升级产品，《友邦全佑倍至重疾保险计划》也完全保留了“全佑一生”系列产品的特色，在主合同中沿用第一类重大疾病保险，对如轻微脑中风、原位癌等8种较为常见的轻度重大疾病进行20%的额外赔付，该赔付可与34种第二类重大疾病100%赔付累加，获得总计最高达120%的赔付；通过两级分类的重疾保障，明确轻重缓急，鼓励及早治疗，从而提高治愈率，让客户“病向浅中医”。", "timestamp": "2017-12-26T10:57:47.733220", "question": "友邦全佑倍至重疾保险计划介绍", "description": "金巧网_保险百科_保险产品"},"sort":[1]},{"_index":"baike","_type":"baoxian","_id":"11","_score":null,"_source":{"answer": "1、投保范围 凡出生满30天至60周岁且身体健康的人，可作为被保险人参加本保险。 2、保险期间 您提出保险申请、经我们同意承保，本合同成立。本合同自我们同意承保、收取足额保险费并签发保险合同开始生效，本合同生效日期在保险单上载明，保单年度、保险费约定支付日均以该日期计算。 3、犹豫期 我们给予您15日的犹豫期，自您签收保险合同之日起算。在此期间如果您确定此保险合同与您的需求不相符，可向我们书面提出解除合同的申请，并将本合同退还我们。本合同自我们收到书面申请当日正式解除，我们自始不承担保险责任，并无息退还已收本合同全部保险费。 4、基本保险金额 本合同的基本保险金额由您在投保时与我们约定，并在保险单上载明，若发生变更，则以变更后的基本保险金额为准。 5、保险责任 工银安盛鑫丰盈主要提供年金、身故保障，并且满期还可返还满期保险金。 从保单生效第5个保单年度起至64周岁，每年领取=当时的基本保额×30%；65-69周岁，每年领取=已交保费×20%；70—104周岁，每年领取=当时的基本保额×40%作为年金。若被保人105周岁仍生存，按满期时的基本保额给付满期金。在合同有效期内，若被保人身故，按已交保费减去累计已领取的年金或合同的现金价值较大者给付身故保险金。", "timestamp": "2017-12-26T10:57:47.733231", "question": "工银安盛鑫丰盈条款", "description": "金巧网_保险百科_保险产品"},"sort":[1]}]}}

# 遍历
gswewf@gswewf-PC:~/yhb$ curl -XPOST localhost:9200/_search/scroll?scroll=110m -d '{"scroll_id":"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAACwFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAsRZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pnAAAAAAAAALIWUUxSZ3drUDBUVDZhY0Q4d1h3Q2dqZwAAAAAAAACzFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAtBZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pn"}'
{"_scroll_id":"DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAACwFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAsRZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pnAAAAAAAAALIWUUxSZ3drUDBUVDZhY0Q4d1h3Q2dqZwAAAAAAAACzFlFMUmd3a1AwVFQ2YWNEOHdYd0NnamcAAAAAAAAAtBZRTFJnd2tQMFRUNmFjRDh3WHdDZ2pn","took":2,"timed_out":false,"terminated_early":true,"_shards":{"total":5,"successful":5,"skipped":0,"failed":0},"hits":{"total":4814,"max_score":null,"hits":[{"_index":"baike","_type":"baoxian","_id":"22","_score":null,"_source":{"answer": "《太平福运金生两全保险》是一款集养老、保障于一身的综合型两全产品，该产品还具有交费第三年后每年有收益、60岁后逐年递增领取、满期返还保费等特点，可匹配客户在子女教育、养老规划、家庭理财等方面的多种需求。", "timestamp": "2017-12-26T10:57:47.733259", "question": "太平福运金生b款怎么样", "description": "金巧网_保险百科_保险产品"},"sort":[2]},{"_index":"baike","_type":"baoxian","_id":"9","_score":null,"_source":{"answer": "1、承保年龄：出生满60日-79周岁 2、保障期限：A款、B款/2-30天，C款、D款/1天 3、购买份数：1-5份", "timestamp": "2017-12-26T10:57:47.733225", "question": "太平出境旅游意外伤害保险投保指南", "description": "金巧网_保险百科_保险产品"},"sort":[2]},{"_index":"baike","_type":"baoxian","_id":"6","_score":null,"_source":{"answer": "1、安联“致青春”重大疾病保险是专为18-35岁青年人士制定的重大疾病保险，多计划、多保额选择； 2、安联“致青春”重大疾病保险的保费低廉，一年期保费15元起，是年轻人都买的起的好保险； 3、安联“致青春”重大疾病保险承保40种常见重大疾病，承保意外身故及伤残，保障全面，重疾、意外都能保。", "timestamp": "2017-12-26T10:57:47.733217", "question": "安联“致青春”重大疾病保险介绍", "description": "金巧网_保险百科_保险产品"},"sort":[2]},{"_index":"baike","_type":"baoxian","_id":"13","_score":null,"_source":{"answer": "1、保障年龄：22-45周岁 2、适合人群：怀孕未满12孕周的女性 3、保障区域：境内", "timestamp": "2017-12-26T10:57:47.733236", "question": "平安“孕安”孕妇健康保险保障范围", "description": "金巧网_保险百科_保险产品"},"sort":[2]},{"_index":"baike","_type":"baoxian","_id":"17","_score":null,"_source":{"answer": "赢越人生单独投保，或以“赢越人生+聚财宝15”组合形式投保时： 同一被保险人赢越单险种累计年交FYP ≤ 50万，且投保人小于60周岁可免核保（违反法律监管合规要求的不在该范围内）。 示例：王先生为0岁儿子购买200万赢越；保额52万，投保人寿险风险保额=52万*20%*（18-0）*30%=56.2万 注：如不在免核保范围，投保人累计寿险风险保额如达到体检标准则需体检 。", "timestamp": "2017-12-26T10:57:47.733246", "question": "平安赢越人生核保要求", "description": "金巧网_保险百科_保险产品"},"sort":[2]},{"_index":"baike","_type":"baoxian","_id":"24","_score":null,"_source":{"answer": "1、投保年龄：0-60周岁； 2、保障期限：10-30年以下 30年-终身； 3、缴费方式：年交、月交、趸交。", "timestamp": "2017-12-26T10:57:47.733264", "question": "国寿幸福双康组合计划投保指南", "description": "金巧网_保险百科_保险产品"},"sort":[3]},{"_index":"baike","_type":"baoxian","_id":"10","_score":null,"_source":{"answer": "30岁的父亲为0岁男宝宝投保尊赢人生保险产品计划，选择祝寿金领取年龄60周岁，交费期间10年，年交保费10万元，基本保额为61100元。该保险计划能带来哪些保险利益呢： 1、首次高返还年金：5岁当年生存，给付150%基本保额，即91650元。 2、年年领取年金：从6岁起至被保险人身故，每生存一年给付30%基本保额，即每年领取18330元。 3、约定返本祝寿金：生存至60周岁约定祝寿金领取日，一次性领取已交保费100万元。 0-90岁共领取：91650+18330×85+1000000=2649700元，即264.97万元。 4、岁岁坐享分红金：每年按不低于70%的可分配盈余分配红利，但注意红利不是每年确定的。 5、万能账户复利增值：上述主险年金、分红金、祝寿金自动进入万能账户进行复利增值。 假设在中档红利下，不同结算利率下保单年度末生存总利益如下： 25周岁：高档结算利率(6%)下约为246万元；中档结算利率(4.5%)下约为220万元；低档结算利率(3%)下约为199万元。 40周岁：高档结算利率下约为565万元；中档结算利率下约为428万元；低档结算利率下约为366万元。 60周岁：高档结算利率下约为1777万元；中档结算利率下约为1050万元；低档结算利率下约为670万元。 80周岁：高档结算利率下约为5882元；中档结算利率下约为2581万元；低档结算利率下约为1247万元。 注意：《人保寿险尊赢人生年金保险(分红型)》为分红保险，其红利分配是不确定的；《人保寿险附加品质生活年金保险(万能型)C款》为万能险，结算利率超过最低保证利率的部分是不确定的。", "timestamp": "2017-12-26T10:57:47.733228", "question": "尊赢人生投保案例", "description": "金巧网_保险百科_保险产品"},"sort":[3]},{"_index":"baike","_type":"baoxian","_id":"15","_score":null,"_source":{"answer": "1、内地居民投保香港条件 （1）有合法证件来香港签署保单。 （2）对香港的制度有基本了解。 （3）投保人健康符合投保要求。 2、内地居民投保香港步骤 （1）投保人带齐证件来港投保（整个流程只需 2 小时左右）； （2）在保险公司签单缴费； （3）在保险公司附近银行开户（方便日后缴费和赔付）。", "timestamp": "2017-12-26T10:57:47.733241", "question": "香港保险投保流程", "description": "金巧网_保险百科_保险产品"},"sort":[3]},{"_index":"baike","_type":"baoxian","_id":"16","_score":null,"_source":{"answer": "1、满期保险金 被保险人在保险期间届满时生存，我们按您所交本合同保险费（不计利息）的110%给付满期保险金，本合同终止。 2、一般身故或全残保险金 被保险人自本合同生效（或最后复效）之日起180日内因意外伤害以外的原因身故或全残，我们按您所交本合同的保险费（不计利息）给付一般身故或全残保险金，本合同终止。 被保险人于年满61周岁后的首个保单年生效对应日零时之前，且自本合同生效（或最后复效）之日起180日后因意外伤害以外的原因身故或全残，我们按您所交本合同保险费（不计利息）的160%给付一般身故或全残保险金，本合同终止。 被保险人于年满61周岁后的首个保单年生效对应日零时之后因意外伤害以外的原因身故或全残，我们按您所交本合同保险费（不计利息）的120%给付一般身故或全残保险金，本合同终止。 3、意外身故或全残保险金 被保险人因遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额给付意外身故或全残保险金，本合同终止。 4、公共交通意外身故或全残保险金 被保险人于年满70周岁后的首个保单年生效对应日零时之前，以乘客身份乘坐除民航班机外的公共交通工具时遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额的10倍给付公共交通意外身故或全残保险金，本合同终止。 被保险人于年满70周岁后的首个保单年生效对应日零时之后，以乘客身份乘坐除民航班机外的公共交通工具时遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额给付公共交通意外身故或全残保险金，本合同终止。 5、法定节假日意外身故或全残保险金 被保险人于年满70周岁后的首个保单年生效对应日零时之前，在法定节假日期间遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额的10倍给付法定节假日意外身故或全残保险金，本合同终止。 被保险人于年满70周岁后的首个保单年生效对应日零时之后，在法定节假日期间遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额给付法定节假日意外身故或全残保险金，本合同终止。 6、重大自然灾害意外身故或全残保险金 被保险人于年满70周岁后的首个保单年生效对应日零时之前，因本合同约定的8种重大自然灾害而遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额的10倍给付重大自然灾害意外身故或全残保险金，本合同终止。 被保险人于年满70周岁后的首个保单年生效对应日零时之后，因本合同约定的8种重大自然灾害而遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额给付重大自然灾害意外身故或全残保险金，本合同终止。 7、电梯意外身故或全残保险金 被保险人于年满70周岁后的首个保单年生效对应日零时之前，在乘坐电梯时因电梯故障而遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额的20倍给付电梯意外身故或全残保险金，本合同终止。 被保险人于年满70周岁后的首个保单年生效对应日零时之后，在乘坐电梯时因电梯故障而遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额给付电梯意外身故或全残保险金，本合同终止。 8、自驾车意外身故或全残保险金 被保险人于年满70周岁后的首个保单年生效对应日零时之前，以乘客身份搭乘或作为驾驶员驾驶自驾车期间时因交通事故而遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额的20倍给付自驾车意外身故或全残保险金，本合同终止。 被保险人于年满70周岁后的首个保单年生效对应日零时之后，以乘客身份搭乘或作为驾驶员驾驶自驾车期间时因交通事故而遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额给付自驾车意外身故或全残保险金，本合同终止。 9、航空交通意外身故或全残保险金 被保险人于年满70周岁后的首个保单年生效对应日零时之前，以乘客身份乘坐作为公共交通工具的民航班机时遭受意外伤害，并且自意外伤害发生之日起180日内因该意外伤害导致身故或全残，我们按基本保险金额的20倍给付航空交通意外身故或全残保险金，本合同终止。", "timestamp": "2017-12-26T10:57:47.733243", "question": "中国人保百万畅行条款", "description": "金巧网_保险百科_保险产品"},"sort":[3]},{"_index":"baike","_type":"baoxian","_id":"23","_score":null,"_source":{"answer": "学平险全称“中小学生平安保险”，是属于人身意外伤害保险的一种，也是团体保险的一种，是针对中小学生特点的一种保险。往往由学生入学时自愿投保。由学校代为收取保险费，被保险人只需交纳几十元的保费就可以获得包括意外伤害、意外伤害医疗以及住院医疗在内的多项保障。是少年儿童投保范围最广，最普遍的一种保险。其最大的特点就是保费便宜而保障范围较为广泛，比较适合未成年学生。各个保险企业一般都制订有自己的学平险条款，各个公司的条款对保险责任、保险金额，赔偿规定等会有一些差别。", "timestamp": "2017-12-26T10:57:47.733262", "question": "学平险是什么", "description": "金巧网_保险百科_保险产品"},"sort":[3]}]}}

同时并行运行多个重建索引任务，但是你显然不希望结果有重叠。正确的做法是按日期或者时间 这样的字段作为过滤条件把大的重建索引分成小的任务：
gswewf@gswewf-PC:~/yhb$ curl -XGET localhost:9200/baike/_search?scroll=1m -d '{
    "query": {
        "range": {
            "timestamp": {
                "gte":  "2014-01-01",
                "lt":   "2018-02-01"
            }
        }
    },
    "sort": ["_doc"],
    "size":  1000
}'

第一步: 创建新索引`baike_v2`:
gswewf@gswewf-PC:~/hello-world/elasticsearch$ curl -XPUT 'localhost:9200/baike_v2' -d '
> {"settings": {"analysis": {"filter": {"my_synonym_filter": {"type": "synonym", "synonyms": ["未到期责任准备金,未赚保费准备金", "人寿保险责任准备金,人身保险责任准备金", "自愿保险,任意保险", "履约保证保险,履约保证险,履约责任保险"]}}, "analyzer": {"my_synonyms": {"tokenizer": "ik_max_word", "filter": ["lowercase", "my_synonym_filter"]}}}}, "mappings": {"baoxian": {"properties": {"question": {"type": "string", "analyzer": "my_synonyms", "index": "analyzed"}, "description": {"type": "string"}, "timestamp": {"type": "date"}, "answer": {"type": "string", "analyzer": "ik_max_word", "index": "analyzed"}}}}}'
{"acknowledged":true,"shards_acknowledged":true,"index":"baike_v2"}

第二步： 将数据从旧索引 baike 索引到 新建索引`baike_v2`


一旦我们确定文档已经被正确地重索引了，我们就将别名指向新的索引。
第三步: 给新建索引取别名
# 给索引`baike_v2`新建别名`baike_alias`：
gswewf@gswewf-PC:~/hello-world/elasticsearch$ curl -XPUT localhost:9200/baike_v2/_alias/baike_alias
{"acknowledged":true}

第四步：更新索引别名
一个别名可以指向多个索引，所以我们在添加别名到新索引的同时必须从旧的索引中删除它。这个操作需要原子化，这意味着我们需要使用 _aliases 操作：
curl -XPOST 'localhost:9200/_aliases?pretty' -H 'Content-Type: application/json' -d'
{
    "actions": [
        { "remove": { "index": "my_index_v1", "alias": "my_index" }},
        { "add":    { "index": "my_index_v2", "alias": "my_index" }}
    ]
}
'

curl -XPOST 'localhost:9200/_aliases?pretty' -H 'Content-Type: application/json' -d'
{
    "actions" : [
        { "add" : { "indices" : ["test1", "test2"], "alias" : "alias1" } }
    ]
}
'

curl -XPOST 'localhost:9200/_aliases?pretty' -H 'Content-Type: application/json' -d'
{
    "actions" : [
        { "add" : { "index" : "test*", "alias" : "all_test_indices" } }
    ]
}
'

curl -XPUT 'localhost:9200/test?pretty'
curl -XPUT 'localhost:9200/test_2?pretty'
# 给索引添加别名，并删除索引(一个或多个)
curl -XPOST 'localhost:9200/_aliases?pretty' -H 'Content-Type: application/json' -d'
{
    "actions" : [
        { "add":  { "index": "test_2", "alias": "test" } },
        { "remove_index": { "index": "test" } },
        {"remove_index": {"indices": ['xinxin_20180227_193218', 'xinxin_20180228_085415']}}

    ]
}
'


实例展示elasticsearch集群生态,分片以及水平扩展.
https://www.cnblogs.com/dennisit/p/4133131.html

